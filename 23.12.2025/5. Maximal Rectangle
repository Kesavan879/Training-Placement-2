class Solution {
    public int maximalRectangle(char[][] matrix) {
        int max = 0;
        int[][] preSum = new int[matrix.length][matrix[0].length];
        // we will calculate largest rectangle for each row histogram
        for(int i=0; i<matrix.length; i++){
            for(int j=0; j<matrix[0].length; j++){
                int ele = matrix[i][j] - '0';
                if(i>0 && matrix[i][j] != '0') preSum[i][j] = preSum[i-1][j] + ele;
                else  preSum[i][j] = ele;
            }
            max = Math.max(max,largestRectangleArea(preSum[i]));
        }
        return max;
    }
    static int largestRectangleArea(int[] arr) {

        int[] pse = new int[arr.length];
        int w,h,area;
        int max = arr[0];

        Stack<Integer> stack = new Stack<>();
        for(int i=0; i<arr.length; i++){
            while(!stack.empty() && arr[i]<arr[stack.peek()]){
                int elementIndex = stack.peek();
                stack.pop(); // because below one in stack is its pse
                int nseIndex = i; // current index is the nse index
                int pseIndex = stack.empty()?-1:stack.peek(); // current top is the pse
                w = nseIndex - pseIndex - 1; //width calculation
                area = arr[elementIndex] * w; //area calculation
                max = Math.max(max,area); //finding max

            }
            pse[i]=stack.empty()?-1:stack.peek();
            stack.push(i);
        }
        while(!stack.empty()){ // if the stack i still not empty
            int elementIndex = stack.peek();
                stack.pop();
                int nseIndex = arr.length; //for all these nse will be length of array
                int pseIndex = stack.empty()?-1:stack.peek();
                w = nseIndex - pseIndex - 1;
                area = arr[elementIndex] * w;
                max = Math.max(max,area);
        }
        return max;
    }
}
